<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SSDO 是 SSAO 的改进版，在 SSAO 的基础上加了环境光和单次反射的间接光信息，效果更好。"><meta name=keywords content="GPU Pro,SSDO,SSAO,AO"><title>GPU Pro 1 笔记 - Screen-Space Directional Occlusion</title><link rel=canonical href=https://www.kindem.xyz/post/54/><link rel=stylesheet href=/scss/style.min.css><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?a0c486208ba4751b6988ccc92f1479ee",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="GPU Pro 1 笔记 - Screen-Space Directional Occlusion"><meta property="og:description" content="SSDO 是 SSAO 的改进版，在 SSAO 的基础上加了环境光和单次反射的间接光信息，效果更好。"><meta property="og:url" content="https://www.kindem.xyz/post/54/"><meta property="og:site_name" content="Kindem的博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Paper"><meta property="article:published_time" content="2022-04-02T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-02T00:00:00+00:00"><meta name=twitter:title content="GPU Pro 1 笔记 - Screen-Space Directional Occlusion"><meta name=twitter:description content="SSDO 是 SSAO 的改进版，在 SSAO 的基础上加了环境光和单次反射的间接光信息，效果更好。"><link rel="shortcut icon" href=#ZgotmplZ><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3YCH8P4PP"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3YCH8P4PP",{anonymize_ip:!1})}</script></head><body><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.body.dataset.scheme="dark":document.body.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu0f5c0aa158a4e8466efa1fc48b48096f_378948_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🎯</span></figure><h1 class=site-name><a href=https://www.kindem.xyz/>Kindem的博客</a></h1><h2 class=site-description>层楼终究误少年，自由早晚乱余生</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索</span></a></li><li><a href=/friends/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>友链</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://www.kindem.xyz/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%8A%80%E6%9C%AF/>技术</a></header><h2 class=article-title><a href=/post/54/>GPU Pro 1 笔记 - Screen-Space Directional Occlusion</a></h2><h3 class=article-subtitle>SSDO 是 SSAO 的改进版，在 SSAO 的基础上加了环境光和单次反射的间接光信息，效果更好。</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Apr 02, 2022</time></footer></div></header><section class=article-content><p>SSDO 全称 Screen Space Directional Occlusion，可以看做一种实时 GI 算法，是 SSAO 的升级版。</p><p>Ambient Occlusion (AO) 即环境光遮蔽是一种常见的提升表面细节的技术，基本思路是在 Mesh 表面预计算周围的遮挡信息，然后在计算光照的时候把遮蔽因子作为系数叠加到环境光上。遮蔽因子计算也比较简单，就是在表面上的一个半球区域内发射一系列射线，然后同级被遮挡的光线的数量即可。应用 AO 后，可以明显看到，表面的拐角处会变得更黑，从而体现出更真实的效果。</p><p>AO 的计算比较耗，通常会为 Mesh 离线计算 AO 纹理，然后在运行时采样直接使用，下面这三张图分别是直接光照、AO 纹理、应用 AO 后的光照：</p><p><figure style=flex-grow:292;flex-basis:701px><a href=/post/54/1.png data-size=848x290><img src=/post/54/1.png srcset="/post/54/1_hub2b17d6ae67239c69e67e1493acfb69a_388582_480x0_resize_box_3.png 480w, /post/54/1_hub2b17d6ae67239c69e67e1493acfb69a_388582_1024x0_resize_box_3.png 1024w" width=848 height=290 loading=lazy></a></figure></p><p>因为 AO 纹理是预计算的，所以对于动态场景就没办法了。于是 SSAO (Screen Space Ambient Occlusion) 应运而生，在屏幕空间进行计算，在开销可以接受的情况下支持动态场景。SSAO 最早是 CryTek 提出的，并运用于自家的引擎 CryEngine 中，最初的 SSAO 算法是直接在屏幕空间表面的一个球形区域内随机进行一系列采样，然后把采样点的深度跟表面的深度相对比，如果在表面之下，则该采样对最终的遮蔽因子产生贡献。下面是盗的 LearnOpenGL 的图：</p><p><figure style=flex-grow:179;flex-basis:430px><a href=/post/54/2.jpg data-size=427x238><img src=/post/54/2.jpg srcset="/post/54/2_hu7ed6a4ee4c87b506d904436d850df5a1_11460_480x0_resize_q75_box.jpg 480w, /post/54/2_hu7ed6a4ee4c87b506d904436d850df5a1_11460_1024x0_resize_q75_box.jpg 1024w" width=427 height=238 loading=lazy></a></figure></p><p>但是这种算法实际效果不太好，会使得画面有一种灰蒙蒙的感觉：</p><p><figure style=flex-grow:156;flex-basis:375px><a href=/post/54/3.jpg data-size=522x334><img src=/post/54/3.jpg srcset="/post/54/3_hu9fe6aa9a8467096f32551606879e5aba_19054_480x0_resize_q75_box.jpg 480w, /post/54/3_hu9fe6aa9a8467096f32551606879e5aba_19054_1024x0_resize_q75_box.jpg 1024w" width=522 height=334 loading=lazy></a></figure></p><p>更好的做法是按照表面的法线取一个半球空间进行采样：</p><p><figure style=flex-grow:182;flex-basis:437px><a href=/post/54/4.jpg data-size=423x232><img src=/post/54/4.jpg srcset="/post/54/4_hu70496e8142eb6f5b70406f79982a2acf_10530_480x0_resize_q75_box.jpg 480w, /post/54/4_hu70496e8142eb6f5b70406f79982a2acf_10530_1024x0_resize_q75_box.jpg 1024w" width=423 height=232 loading=lazy></a></figure></p><p>这样效果会更好，但是无论如何，SSAO 有个致命的缺陷，就是它只考虑了遮挡关系，所以只能让拐角处 “更黑”，还是没办法记录光照信息。比如下面这张图，P 点附近有两个颜色不同的光源，按照遮挡关系，P 点应该会被绿光照亮，从而体现出绿色，而不是 SSAO 表现出来的黑色：</p><p><figure style=flex-grow:114;flex-basis:274px><a href=/post/54/5.png data-size=299x261><img src=/post/54/5.png srcset="/post/54/5_hu6e70dc080b87cdcad7fe417012b37d73_16116_480x0_resize_box_3.png 480w, /post/54/5_hu6e70dc080b87cdcad7fe417012b37d73_16116_1024x0_resize_box_3.png 1024w" width=299 height=261 loading=lazy></a></figure></p><p>SSDO 的提出就是为了解决这个问题，SSDO 在计算遮挡关系的同时还会考虑光照信息，从而让拐角处产生能带颜色的遮蔽效果：</p><p><figure style=flex-grow:260;flex-basis:625px><a href=/post/54/6.png data-size=761x292><img src=/post/54/6.png srcset="/post/54/6_hu5725186dbe4a05a37aa86bcd08dc4ee3_331742_480x0_resize_box_3.png 480w, /post/54/6_hu5725186dbe4a05a37aa86bcd08dc4ee3_331742_1024x0_resize_box_3.png 1024w" width=761 height=292 loading=lazy></a></figure></p><p>首先来看下 SSDO 怎么捕获直接光信息：</p><p><figure style=flex-grow:173;flex-basis:416px><a href=/post/54/7.png data-size=1052x606><img src=/post/54/7.png srcset="/post/54/7_hud756674d587bb7c0b31b9331e5d30c4c_103510_480x0_resize_box_3.png 480w, /post/54/7_hud756674d587bb7c0b31b9331e5d30c4c_103510_1024x0_resize_box_3.png 1024w" width=1052 height=606 loading=lazy></a></figure></p><p>我们在 P 点法线方向的一个半球空间中均匀散布一些采样点，用类似 SSAO 的方法，我们可以得知他们是在表面之上还是之下，如果在之上的话，就按照 P 点与采样点的连线方向采样 IrradianceEnvMap 即可，各个采样点的贡献累加后就是 P 点最终的直接光颜色。</p><p><figure style=flex-grow:369;flex-basis:886px><a href=/post/54/8.png data-size=1397x378><img src=/post/54/8.png srcset="/post/54/8_hua0428d71ef9a18d8130b83c4d16472fa_557482_480x0_resize_box_3.png 480w, /post/54/8_hua0428d71ef9a18d8130b83c4d16472fa_557482_1024x0_resize_box_3.png 1024w" width=1397 height=378 loading=lazy></a></figure></p><p>要提一句 EnvMap，EnvMap 原图保存的是 LatLong 格式的 Radiance（左图），对其进行高斯模糊可以得到一个小锥形区域内的 Irradiance（右图），我们在 SSDO 算法中采样的是右边这张图。</p><p><figure style=flex-grow:526;flex-basis:1264px><a href=/post/54/9.png data-size=711x135><img src=/post/54/9.png srcset="/post/54/9_hu49e67aaf28267a922c3db537363d0276_16816_480x0_resize_box_3.png 480w, /post/54/9_hu49e67aaf28267a922c3db537363d0276_16816_1024x0_resize_box_3.png 1024w" width=711 height=135 loading=lazy></a></figure></p><p>上面是 P 点直接光信息的计算公式，没有 Latex 不好打公式解释，需要实现的朋友们自己看下论文原文吧，这里就放一放。</p><p><figure style=flex-grow:279;flex-basis:670px><a href=/post/54/10.png data-size=1382x495><img src=/post/54/10.png srcset="/post/54/10_hu64e189b4baf4efc8513c901f7a605929_1354258_480x0_resize_box_3.png 480w, /post/54/10_hu64e189b4baf4efc8513c901f7a605929_1354258_1024x0_resize_box_3.png 1024w" width=1382 height=495 loading=lazy></a></figure></p><p>我们可以看到加上了直接光信息后，体现出来的遮蔽效果是带颜色的，效果会比 SSAO 好很多。</p><p><figure style=flex-grow:184;flex-basis:443px><a href=/post/54/11.png data-size=916x496><img src=/post/54/11.png srcset="/post/54/11_huc1dff43360da5681db411d98f707d988_66583_480x0_resize_box_3.png 480w, /post/54/11_huc1dff43360da5681db411d98f707d988_66583_1024x0_resize_box_3.png 1024w" width=916 height=496 loading=lazy></a></figure></p><p>SSDO 可不光能搞定直接光信息，还可以从表面附近的其他表面获取反射过来的间接光（反射前是直接光）信息。看图中，对于所有被遮挡的采样点，我们都找到他们在表面上真正对应的点，然后根据表面的法线计算对 P 点贡献的间接光。</p><p><figure style=flex-grow:329;flex-basis:791px><a href=/post/54/12.png data-size=1157x351><img src=/post/54/12.png srcset="/post/54/12_hue1db638360255e581faa021cc6f16ca6_49910_480x0_resize_box_3.png 480w, /post/54/12_hue1db638360255e581faa021cc6f16ca6_49910_1024x0_resize_box_3.png 1024w" width=1157 height=351 loading=lazy></a></figure></p><p>公式如上。</p><p><figure style=flex-grow:290;flex-basis:697px><a href=/post/54/13.png data-size=1366x470><img src=/post/54/13.png srcset="/post/54/13_hu231c6d52f9cb9184832f9b822eb5d356_1316569_480x0_resize_box_3.png 480w, /post/54/13_hu231c6d52f9cb9184832f9b822eb5d356_1316569_1024x0_resize_box_3.png 1024w" width=1366 height=470 loading=lazy></a></figure></p><p>可以看到效果又提升了一个档次。</p><hr><p>总结一波：SSDO 是 SSAO 的后继者，要比 SSAO 效果更好但是更耗。在 SSAO 计算遮挡信息的基础上考虑了光照信息，可以对所有没有被遮挡的采样点计算一次直接光贡献，对所有被遮挡的采样点计算一次间接光贡献，最后得到带颜色的环境光遮蔽效果。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/paper/>Paper</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/post/49/><div class=article-details><h2 class=article-title>GPU Pro 1 笔记 - As Simple as Possible Tessellation for Interactive Applications</h2></div></a></article><article><a href=/post/58/><div class=article-details><h2 class=article-title>如何以酷炫的姿势造一个 C++ 动态反射轮子</h2></div></a></article><article><a href=/post/57/><div class=article-details><h2 class=article-title>GDC 笔记 - Simulating Tropical Weather in FARCRY6</h2></div></a></article><article><a href=/post/56/><div class=article-details><h2 class=article-title>GDC 笔记 - FidelityFX Super Resolution 2.0</h2></div></a></article><article><a href=/post/55/><div class=article-details><h2 class=article-title>CryEngine5 Shader 调试</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=FlyAndNotDown/KindemBlog issue-term=title crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;setUtterancesTheme(document.body.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2023 Kindem的博客</section><section class=powerby>©2017-2021 Copyright kindem.xyz / 湘ICP备17018771号-1<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>