<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="最近在搞 UE 地形的魔改与优化，简单记录一下地形系统的学习。"><meta name=keywords content="unreal,ue,landscape,地形"><title>UE5 地形系统初探</title><link rel=canonical href=https://www.kindem.xyz/post/50/><link rel=stylesheet href=/scss/style.min.css><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?a0c486208ba4751b6988ccc92f1479ee",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="UE5 地形系统初探"><meta property="og:description" content="最近在搞 UE 地形的魔改与优化，简单记录一下地形系统的学习。"><meta property="og:url" content="https://www.kindem.xyz/post/50/"><meta property="og:site_name" content="Kindem的博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="UE"><meta property="article:published_time" content="2021-12-05T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-05T00:00:00+00:00"><meta name=twitter:title content="UE5 地形系统初探"><meta name=twitter:description content="最近在搞 UE 地形的魔改与优化，简单记录一下地形系统的学习。"><link rel="shortcut icon" href=#ZgotmplZ><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3YCH8P4PP"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3YCH8P4PP",{anonymize_ip:!1})}</script></head><body><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.body.dataset.scheme="dark":document.body.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu0f5c0aa158a4e8466efa1fc48b48096f_378948_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🎯</span></figure><h1 class=site-name><a href=https://www.kindem.xyz/>Kindem的博客</a></h1><h2 class=site-description>层楼终究误少年，自由早晚乱余生</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索</span></a></li><li><a href=/friends/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>友链</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://www.kindem.xyz/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%8A%80%E6%9C%AF/>技术</a></header><h2 class=article-title><a href=/post/50/>UE5 地形系统初探</a></h2><h3 class=article-subtitle>最近在搞 UE 地形的魔改与优化，简单记录一下地形系统的学习。</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Dec 05, 2021</time></footer></div></header><section class=article-content><blockquote><p>使用的版本：UE5 Early Access</p></blockquote><h1 id=地形系统介绍>地形系统介绍</h1><p>UE 可以直接在编辑器中创建并编辑地形，编辑地形的模式有两种：Sculpt 和 Paint。</p><ul><li>Sculpt 的作用是对地形进行造型和雕刻，Sculpt 对地形产生的修改最终会体现在 Heightmap 即高度图中，UE 会在运行时对这张图进行采样，从而产生地形 Mesh，很经典的做法。</li><li>Paint 则可以让开发者对地表进行绘制，开发者可以创建多个 Landscape Layer，每一个 Layer 可以使用不同的纹理，比如雪地、草地、土壤等，在 Paint 模式下，用户可以选择不同的 Layer 对地形进行绘制，绘制完成后，会根据 Layer 的数量生成对应的 Weightmap 即权重图，其中保存了每一个 Layer 的权重，由于 Weightmap 有 RGBA 四个通道，一张 Weightmap 至多能保存四个 Layer，每四个 Layer 会额外生成一张 Weightmap，Layer 数量越多，显存消耗越大。在运行时，UE 会对当前地块的 Weightmap 和 Layer 纹理进行采样，并进行混合，最终形成地表。</li></ul><p>在创建地形的时候，有 Section 的概念，Section 可以认为是一块地形，每一个地形 Component 可以选择保存 1x1 或者 2x2 块 Section，创建地形的时候，需要输入 Section 的大小和 Component 的数量，来决定最终地形的大小。</p><p>要在 UE 中创建地形，需要先切换到 Landscape Editing Mode：</p><p><figure style=flex-grow:1995;flex-basis:4788px><a href=/post/50/1.jpg data-size=2135x107><img src=/post/50/1.jpg srcset="/post/50/1_hu1f4359908e7060a40e6bd17e6581c9d6_15641_480x0_resize_q75_box.jpg 480w, /post/50/1_hu1f4359908e7060a40e6bd17e6581c9d6_15641_1024x0_resize_q75_box.jpg 1024w" width=2135 height=107 loading=lazy alt="Landscape Editing Mode"></a><figcaption>Landscape Editing Mode</figcaption></figure></p><p>在 Manage 面板，我们可以输入参数创建新的地形：</p><p><figure style=flex-grow:41;flex-basis:99px><a href=/post/50/2.jpg data-size=397x960><img src=/post/50/2.jpg srcset="/post/50/2_hu9594d5b32762b9f81bbe8e92f46aa90e_32218_480x0_resize_q75_box.jpg 480w, /post/50/2_hu9594d5b32762b9f81bbe8e92f46aa90e_32218_1024x0_resize_q75_box.jpg 1024w" width=397 height=960 loading=lazy alt="Landscape Manage"></a><figcaption>Landscape Manage</figcaption></figure></p><p>完成创建后，会生成一个 Landscape 的 Actor：</p><p><figure style=flex-grow:194;flex-basis:467px><a href=/post/50/3.jpg data-size=2142x1099><img src=/post/50/3.jpg srcset="/post/50/3_hu9d04a4ff8c3f3c89173c97f1488aac61_154922_480x0_resize_q75_box.jpg 480w, /post/50/3_hu9d04a4ff8c3f3c89173c97f1488aac61_154922_1024x0_resize_q75_box.jpg 1024w" width=2142 height=1099 loading=lazy alt=Landscape></a><figcaption>Landscape</figcaption></figure></p><p>之后切换到 Sculpt 模式即可进行雕刻，有很多工具可供选择，我这里随便整了个地形：</p><p><figure style=flex-grow:194;flex-basis:467px><a href=/post/50/4.jpg data-size=2142x1099><img src=/post/50/4.jpg srcset="/post/50/4_hu52cd22c38a6c069326b539a9ff2d6296_227074_480x0_resize_q75_box.jpg 480w, /post/50/4_hu52cd22c38a6c069326b539a9ff2d6296_227074_1024x0_resize_q75_box.jpg 1024w" width=2142 height=1099 loading=lazy alt=Sculpt></a><figcaption>Sculpt</figcaption></figure></p><p>下一步就是刷地表，在刷地表之前，我们先要为每一层 Layer 创建一个 MaterialFunction，每个 MaterialFunction 使用 Landscape TexCoord 采样自己需要的纹理，然后输出一个 MaterialAttribute，我这里为了简单起见，直接用 LandscapeCoords 采 BaseColor 然后返回，Normal 给 (0, 0, 1)，实际上做的时候材质是会很复杂的（要注意不光 BaseColor 会做混合，而是所有的 MaterialAttribute 都会做混合）：</p><p><figure style=flex-grow:203;flex-basis:489px><a href=/post/50/5.jpg data-size=2242x1100><img src=/post/50/5.jpg srcset="/post/50/5_hu0722130cfc60d6681eadef283a67acdd_242255_480x0_resize_q75_box.jpg 480w, /post/50/5_hu0722130cfc60d6681eadef283a67acdd_242255_1024x0_resize_q75_box.jpg 1024w" width=2242 height=1100 loading=lazy alt="Layer Grass"></a><figcaption>Layer Grass</figcaption></figure></p><p>做完了草，再做几层其他的，也是类似的：</p><p><figure style=flex-grow:189;flex-basis:454px><a href=/post/50/6.jpg data-size=356x188><img src=/post/50/6.jpg srcset="/post/50/6_hu2595fa897226528195010679f49305c8_12455_480x0_resize_q75_box.jpg 480w, /post/50/6_hu2595fa897226528195010679f49305c8_12455_1024x0_resize_q75_box.jpg 1024w" width=356 height=188 loading=lazy alt=Layers></a><figcaption>Layers</figcaption></figure></p><p>接下来我们需要创建地形的材质，并在其中使用 LandscapeLayerBlend 节点对多层地表进行混合：</p><p><figure style=flex-grow:203;flex-basis:489px><a href=/post/50/7.jpg data-size=2242x1100><img src=/post/50/7.jpg srcset="/post/50/7_hu988348219d7404552e269d626fef30d4_221142_480x0_resize_q75_box.jpg 480w, /post/50/7_hu988348219d7404552e269d626fef30d4_221142_1024x0_resize_q75_box.jpg 1024w" width=2242 height=1100 loading=lazy alt=LandscapeLayerBlend></a><figcaption>LandscapeLayerBlend</figcaption></figure></p><p>注意材质选项中勾选 Use Material Attributes 来直接输出 Material Attributes，然后 MF_ 开头的三个就是我们之前创建的三个 Layer，在 Landscape Layer Blend 节点中填写 LayerName 并把对应的 Layer 连上来即可。</p><p>接下来选中 Landscape Actor，将其材质设置成我们刚刚创建的这个材质：</p><p><figure style=flex-grow:44;flex-basis:107px><a href=/post/50/8.jpg data-size=432x961><img src=/post/50/8.jpg srcset="/post/50/8_hud4d1646c5f362c7d1f78dfd79c51f334_46202_480x0_resize_q75_box.jpg 480w, /post/50/8_hud4d1646c5f362c7d1f78dfd79c51f334_46202_1024x0_resize_q75_box.jpg 1024w" width=432 height=961 loading=lazy alt="Landscape Material"></a><figcaption>Landscape Material</figcaption></figure></p><p>这时候你可以注意到，左边的 Paint 面板已经自动识别到了我们刚刚创建的几个 Layer：</p><p><figure style=flex-grow:265;flex-basis:638px><a href=/post/50/9.jpg data-size=436x164><img src=/post/50/9.jpg srcset="/post/50/9_hu83207f62c2ec2382c0f57697379cfb6c_10781_480x0_resize_q75_box.jpg 480w, /post/50/9_hu83207f62c2ec2382c0f57697379cfb6c_10781_1024x0_resize_q75_box.jpg 1024w" width=436 height=164 loading=lazy alt="Paint Layers"></a><figcaption>Paint Layers</figcaption></figure></p><p>我们需要为每一层 Layer 创建一个 LayerInfo Object，后面 UE 将使用这个信息来创建 Weightmap，点击右边的 + 号，然后选择 Weight-Blended Layer 即可：</p><p><figure style=flex-grow:185;flex-basis:445px><a href=/post/50/10.jpg data-size=353x190><img src=/post/50/10.jpg srcset="/post/50/10_hu8643d134fb844a13d6be8a9856f1bc1e_7290_480x0_resize_q75_box.jpg 480w, /post/50/10_hu8643d134fb844a13d6be8a9856f1bc1e_7290_1024x0_resize_q75_box.jpg 1024w" width=353 height=190 loading=lazy alt="Layer Infos"></a><figcaption>Layer Infos</figcaption></figure></p><p>这时候你会发现地形从黑色变成了第一层 Layer，这是因为当识别到有 LayerInfo Object 时，如果各层权重之和不为 1，UE 会默认使用第一层 Layer 来填满剩余的权重。</p><p>最后选中不同的 Layer 即可直接在地形上绘制地表，我这随便画了点：</p><p><figure style=flex-grow:194;flex-basis:467px><a href=/post/50/11.jpg data-size=2142x1099><img src=/post/50/11.jpg srcset="/post/50/11_hu88f1eeb6f104f5fe87e6ebab4969866e_207087_480x0_resize_q75_box.jpg 480w, /post/50/11_hu88f1eeb6f104f5fe87e6ebab4969866e_207087_1024x0_resize_q75_box.jpg 1024w" width=2142 height=1099 loading=lazy alt=Painting></a><figcaption>Painting</figcaption></figure></p><p>地形的基本功能就是这样了，原谅我的美术水平实在太糟糕 &mldr;..</p><h1 id=renderdoc-分析>RenderDoc 分析</h1><p>先抓一帧：</p><p><figure style=flex-grow:194;flex-basis:465px><a href=/post/50/12.jpg data-size=2156x1111><img src=/post/50/12.jpg srcset="/post/50/12_hu2cde34963837050b9d7163df563a8e8a_258753_480x0_resize_q75_box.jpg 480w, /post/50/12_hu2cde34963837050b9d7163df563a8e8a_258753_1024x0_resize_q75_box.jpg 1024w" width=2156 height=1111 loading=lazy alt="Landscape DrawCalls"></a><figcaption>Landscape DrawCalls</figcaption></figure></p><p>可以看见最终是一个 Component 一个 DrawCall，一次只画一块，接下来可以看看 Heightmap 和 Weightmap：</p><p><figure style=flex-grow:194;flex-basis:465px><a href=/post/50/13.jpg data-size=2156x1111><img src=/post/50/13.jpg srcset="/post/50/13_hu15cfc8c7386a9146ac0449187f480f66_261565_480x0_resize_q75_box.jpg 480w, /post/50/13_hu15cfc8c7386a9146ac0449187f480f66_261565_1024x0_resize_q75_box.jpg 1024w" width=2156 height=1111 loading=lazy alt="Heightmap & Weightmap"></a><figcaption>Heightmap & Weightmap</figcaption></figure></p><p>Landscape 的 DrawCall 中可以清楚地看见 Heightmap 和 Weightmap，上面那张就是 Heightmap，整个地形一张，而下面的 Weightmap 则是按 Component 来的，每个 Component 一张。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/ue/>UE</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/post/57/><div class=article-details><h2 class=article-title>GDC 笔记 - Simulating Tropical Weather in FARCRY6</h2></div></a></article><article><a href=/post/56/><div class=article-details><h2 class=article-title>GDC 笔记 - FidelityFX Super Resolution 2.0</h2></div></a></article><article><a href=/post/55/><div class=article-details><h2 class=article-title>CryEngine5 Shader 调试</h2></div></a></article><article><a href=/post/54/><div class=article-details><h2 class=article-title>GPU Pro 1 笔记 - Screen-Space Directional Occlusion</h2></div></a></article><article><a href=/post/53/><div class=article-details><h2 class=article-title>GDC 笔记 - Quadtree Displacement Mapping with Height Blending</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=FlyAndNotDown/KindemBlog issue-term=title crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;setUtterancesTheme(document.body.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2023 Kindem的博客</section><section class=powerby>©2017-2021 Copyright kindem.xyz / 湘ICP备17018771号-1<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>