<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="我和 Explosion 游戏引擎那些事"><meta name=keywords content="explosion,c++,游戏引擎,渲染,图形"><title>Explosion 开发笔记 (三)</title><link rel=canonical href=https://flyandnotdown.github.io/post/40/><link rel=stylesheet href=/scss/style.min.css><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?a0c486208ba4751b6988ccc92f1479ee",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Explosion 开发笔记 (三)"><meta property="og:description" content="我和 Explosion 游戏引擎那些事"><meta property="og:url" content="https://flyandnotdown.github.io/post/40/"><meta property="og:site_name" content="Kindem的博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Explosion"><meta property="article:tag" content="Game"><meta property="article:tag" content="Graphics"><meta property="article:published_time" content="2021-05-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-27T00:00:00+00:00"><meta name=twitter:title content="Explosion 开发笔记 (三)"><meta name=twitter:description content="我和 Explosion 游戏引擎那些事"><link rel="shortcut icon" href=#ZgotmplZ><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3YCH8P4PP"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3YCH8P4PP",{anonymize_ip:!1})}</script></head><body><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.body.dataset.scheme="dark":document.body.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu0f5c0aa158a4e8466efa1fc48b48096f_378948_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🎯</span></figure><h1 class=site-name><a href=https://flyandnotdown.github.io/>Kindem的博客</a></h1><h2 class=site-description>层楼终究误少年，自由早晚乱余生</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索</span></a></li><li><a href=/friends/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>友链</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://flyandnotdown.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%8A%80%E6%9C%AF/>技术</a></header><h2 class=article-title><a href=/post/40/>Explosion 开发笔记 (三)</a></h2><h3 class=article-subtitle>我和 Explosion 游戏引擎那些事</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>May 27, 2021</time></footer></div></header><section class=article-content><h1 id=进展概览>进展概览</h1><h2 id=repo-建设>Repo 建设</h2><p>先说说最近的进展吧，首先是 Repo 方面的建设，README 先写起来占坑了，顺便随手自己画了张 logo 图上丢上去占坑，可以简单看看现在的 README：</p><p><figure style=flex-grow:82;flex-basis:197px><a href=/post/40/1.png data-size=933x1132><img src=/post/40/1.png srcset="/post/40/1_hu4edd90293ef6d47756489ca8548c4a38_146605_480x0_resize_box_3.png 480w, /post/40/1_hu4edd90293ef6d47756489ca8548c4a38_146605_1024x0_resize_box_3.png 1024w" width=933 height=1132 loading=lazy alt=README></a><figcaption>README</figcaption></figure></p><p>回头还需要把中文版的 README 和其他的细节慢慢补起来，不过我们现在真没太多人力投入这块，要做的东西太多了，之后把引擎本身完善的差不多了之后再慢慢弄吧。</p><h2 id=工程管理>工程管理</h2><p>我们在团队内推崇大家使用 Issues 来交流、跟踪进展，使用 Project 来管理整个项目，大概效果是这样：</p><p><figure style=flex-grow:125;flex-basis:301px><a href=/post/40/3.png data-size=1280x1018><img src=/post/40/3.png srcset="/post/40/3_huf917cdfd3565aad66b71d45323e3cc93_214163_480x0_resize_box_3.png 480w, /post/40/3_huf917cdfd3565aad66b71d45323e3cc93_214163_1024x0_resize_box_3.png 1024w" width=1280 height=1018 loading=lazy alt=Issues></a><figcaption>Issues</figcaption></figure></p><p><figure style=flex-grow:140;flex-basis:337px><a href=/post/40/4.png data-size=1462x1041><img src=/post/40/4.png srcset="/post/40/4_hu860f4db80a85fae58b388180c606b79f_319636_480x0_resize_box_3.png 480w, /post/40/4_hu860f4db80a85fae58b388180c606b79f_319636_1024x0_resize_box_3.png 1024w" width=1462 height=1041 loading=lazy alt=Project></a><figcaption>Project</figcaption></figure></p><p>提交 Issues 会自动关联到 Project，MR 中需要关联对应的 Issues，在 MR 关闭时，Issues 会自动跟随 MR 关闭，并移动到 Project 的 Done 一栏，这样我们就能方便地跟踪需求和进展。</p><h2 id=ci>CI</h2><p>CI 方面我们目前使用的是 <a class=link href=https://docs.github.com/cn/actions target=_blank rel=noopener>GitHub Actions</a>，不得不说这玩意可塑性要比其他的 CI/CD 工具强很多，写起来也是比较方便的，目前 CI 就配置了一个 cmake 构建，覆盖平台有：</p><ul><li>Ubuntu</li><li>Windows</li></ul><p>具体的代码在这：<a class=link href=https://github.com/ExplosionEngine/Explosion/tree/master/.github/workflows target=_blank rel=noopener>Actions Code</a>，提交 MR 后自动触发，构建结果可以在 <a class=link href=https://github.com/ExplosionEngine/Explosion/actions target=_blank rel=noopener>Actions</a> 查询：</p><p><figure style=flex-grow:128;flex-basis:307px><a href=/post/40/2.png data-size=1314x1025><img src=/post/40/2.png srcset="/post/40/2_hu943882e654f15d85ad288fba56519395_221393_480x0_resize_box_3.png 480w, /post/40/2_hu943882e654f15d85ad288fba56519395_221393_1024x0_resize_box_3.png 1024w" width=1314 height=1025 loading=lazy alt="Action Result"></a><figcaption>Action Result</figcaption></figure></p><p>构建通过是合入的硬性指标。其实我在纠结 MacOS 要不要加，因为实际上从构建来说，MacOS 的编译器和 GCC 还是比较一致的，一般不会出什么大岔子，后面再说吧。</p><h2 id=构建系统优化>构建系统优化</h2><p>我抽空对所有的 CMake 进行了一次重构，主要做的事情是把常用的一些基本 CMake 指令做了一次封装，主要涉及：</p><ul><li>add_executable</li><li>add_library</li><li>add_test</li></ul><p>我把他们封装成了：</p><ul><li>exp_add_executable</li><li>exp_add_library</li><li>exp_add_test</li></ul><p>其实做的事情很简单，就是在原有指令的基础上，把头文件目录、链接库这类必备的操作与其合并了，用起来会更方便些，下面是一段示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=nb>exp_add_executable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>NAME</span> <span class=o>${</span><span class=nv>TARGET_NAME</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>SRCS</span> <span class=o>${</span><span class=nv>TARGET_SOURCES</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>INC_DIRS</span> <span class=o>${</span><span class=nv>TARGET_INCLUDE_DIRS</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>LIBS</span> <span class=o>${</span><span class=nv>TARGET_LIBS</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>exp_add_library</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>NAME</span> <span class=o>${</span><span class=nv>TARGET_NAME</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>TYPE</span> <span class=o>${</span><span class=nv>TARGET_TYPE</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>SRCS</span> <span class=o>${</span><span class=nv>TARGET_SOURCES</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>PRIVATE_INC_DIRS</span> <span class=o>${</span><span class=nv>TARGET_PRIVATE_INCLUDE_DIRS</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>PUBLIC_INC_DIRS</span> <span class=o>${</span><span class=nv>TARGET_PUBLIC_INCLUDE_DIRS</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>LIB</span> <span class=o>${</span><span class=nv>TARGET_LIBS</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>exp_add_test</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>NAME</span> <span class=o>${</span><span class=nv>TARGET_NAME</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>WORKING_DIR</span> <span class=o>${</span><span class=nv>TARGET_WORKING_DIR</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>SRCS</span> <span class=o>${</span><span class=nv>TARGET_SOURCES</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>INC_DIRS</span> <span class=o>${</span><span class=nv>TARGET_INCLUDE_DIRS</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>LIB</span> <span class=o>${</span><span class=nv>TARGET_LIBS</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=err>
</span></span></span></code></pre></div><p>目的就是统一大家写 CMake 的风格。</p><h2 id=代码质量控制>代码质量控制</h2><p>经过一番考量，我暂时选用了 <a class=link href=https://www.codacy.com/ target=_blank rel=noopener>Codacy</a> 作为我们的静态检查工具，因为是纯在线的工具，完全不需要集成，只需要按步骤启用 GitHub App 即可启用扫描，可以在 <a class=link href=https://app.codacy.com/gh/ExplosionEngine/Explosion/dashboard target=_blank rel=noopener>Codacy Dashboard - Explosion</a> 找到静态扫描结果：</p><p><figure style=flex-grow:146;flex-basis:351px><a href=/post/40/5.png data-size=1695x1158><img src=/post/40/5.png srcset="/post/40/5_hu02ad30fe28b8eede46e408fff7a03b13_168185_480x0_resize_box_3.png 480w, /post/40/5_hu02ad30fe28b8eede46e408fff7a03b13_168185_1024x0_resize_box_3.png 1024w" width=1695 height=1158 loading=lazy alt="Codacy Dashboard"></a><figcaption>Codacy Dashboard</figcaption></figure></p><p>主干的代码提交以及 MR 会自动触发静态扫描，之后评级会自动刷新，然后同步到 README 的 Badge 中：</p><p><figure style=flex-grow:256;flex-basis:616px><a href=/post/40/6.png data-size=884x344><img src=/post/40/6.png srcset="/post/40/6_hu228af9f4b45c2189636432856def1232_48250_480x0_resize_box_3.png 480w, /post/40/6_hu228af9f4b45c2189636432856def1232_48250_1024x0_resize_box_3.png 1024w" width=884 height=344 loading=lazy alt="Codacy Badge"></a><figcaption>Codacy Badge</figcaption></figure></p><p>至于代码风格、安全问题、圈复杂度、重复率的扫描要不要整合到 CI 中，之后再考虑吧，现在来说已经够用了~</p><h2 id=rhi-重构>RHI 重构</h2><p>最近投入 Explosion 的时间并不是很多，RHI 重构算是最近的主要进展了，我之前写过一篇文章叫做 <a class=link href=https://flyandnotdown.github.io/post/39/ target=_blank rel=noopener>《醒醒吧，静态多态根本没有这么香》</a>，其实主要纠结的地方在于要不要追求极限性能，把 RHI 的主要架子完全用模板实现，但我最后还是放弃了。</p><p>模板在大型的架构设计与代码量级下会带来很多负面影响，主要会直接影响到接口的设计，虽然性能高，但我最后还是决定使用传统的 OOP 来完成 RHI 的编写。</p><p>抛开这些，我总算是决定先把 VulkanDriver 拆分出来了，抽象了一套公共的 Driver 接口，用于以后实现 DX12 和 Metal 后端，我很庆幸先做了这件事，不然后面改起来估计更蛋疼。</p><p>目前封装的类有：</p><ul><li>Driver</li><li>Device</li><li>CommandBuffer</li><li>Buffer</li><li>Sampler</li><li>Image</li><li>ImageView</li><li>FrameBuffer</li><li>SwapChain</li><li>RenderPass</li><li>GraphicsPipeline</li><li>ComputePipeline</li><li>DescriptorPool</li><li>DescriptorSet</li><li>Signal</li></ul><p>封装粒度还是相对比较细的，之后准备通过脚本 / 插件的形式将 RHI 和 RPI 一起提供出去，为用户自己造 Renderer 提供可能性（咱们之后的 DefaultRenderer 本身就会作为一个插件提供）。</p><p>RHI 要走的路还很长，不过我打算小步快跑，先用 VulkanDriver 顶着，慢慢把上面的代码也写起来，让其他团队成员也能快速地参与进来。</p><h2 id=rpi--framegraph>RPI / FrameGraph</h2><p>RPI / FrameGraph 主要由 <a class=link href=https://github.com/bluesky013 target=_blank rel=noopener>bluesky013</a> 操刀，思路主要参考 GDC 2017 寒霜引擎的一次 Talk，可以在 <a class=link href=https://www.gdcvault.com/play/1024612/FrameGraph-Extensible-Rendering-Architecture-in target=_blank rel=noopener>GDC Vault - FrameGraph</a> 找到这次 Talk 的 PPT。</p><p>我们设计的蓝本就是这个 Talk，目前逻辑差不多写完了，不过 AsyncComputePass 和 TransitionResources 处理上还有点小问题。</p><p>下面简单讲讲 FrameGraph：</p><p><figure style=flex-grow:178;flex-basis:428px><a href=/post/40/7.png data-size=987x553><img src=/post/40/7.png srcset="/post/40/7_huc330f5e164c69c996e14feb6539f424c_561031_480x0_resize_box_3.png 480w, /post/40/7_huc330f5e164c69c996e14feb6539f424c_561031_1024x0_resize_box_3.png 1024w" width=987 height=553 loading=lazy alt="FrameGraph Goals"></a><figcaption>FrameGraph Goals</figcaption></figure></p><p>FrameGraph 的目标很简单，就是用一种合理、可预测的方式去维护 Renderer 中繁重不堪的资源与 RenderPass 的依赖关系。从另外一种角度讲，FrameGraph 的作用是让渲染流程更清晰、可维护。下面是一个简单的例子：</p><p><figure style=flex-grow:178;flex-basis:429px><a href=/post/40/8.png data-size=996x557><img src=/post/40/8.png srcset="/post/40/8_hue4fba2b2479aff60ca43ffb224603f8b_540229_480x0_resize_box_3.png 480w, /post/40/8_hue4fba2b2479aff60ca43ffb224603f8b_540229_1024x0_resize_box_3.png 1024w" width=996 height=557 loading=lazy alt="FramGraph Example"></a><figcaption>FramGraph Example</figcaption></figure></p><p>黄色的节点是 RenderPass，蓝色的节点是资源，红色节点是送显，它很好地描述了一帧中资源和渲染流程的关系（但是要注意的是它并不维护具体的渲染任务，也就是它不管 Pipeline）。下面是几张资源和 RenderPass 的图：</p><p><figure style=flex-grow:178;flex-basis:427px><a href=/post/40/9.png data-size=927x520><img src=/post/40/9.png srcset="/post/40/9_huc2758c5f8784421a5131dd4242d8b055_208769_480x0_resize_box_3.png 480w, /post/40/9_huc2758c5f8784421a5131dd4242d8b055_208769_1024x0_resize_box_3.png 1024w" width=927 height=520 loading=lazy alt="FrameGraph Resources"></a><figcaption>FrameGraph Resources</figcaption></figure></p><p><figure style=flex-grow:178;flex-basis:427px><a href=/post/40/10.png data-size=930x522><img src=/post/40/10.png srcset="/post/40/10_hu516fc7a0940c58550b830fa2c8b624e8_224783_480x0_resize_box_3.png 480w, /post/40/10_hu516fc7a0940c58550b830fa2c8b624e8_224783_1024x0_resize_box_3.png 1024w" width=930 height=522 loading=lazy alt="FrameGraph Examples"></a><figcaption>FrameGraph Examples</figcaption></figure></p><p><figure style=flex-grow:178;flex-basis:428px><a href=/post/40/11.png data-size=931x522><img src=/post/40/11.png srcset="/post/40/11_hu525c911a4e995de71482783026d39910_223045_480x0_resize_box_3.png 480w, /post/40/11_hu525c911a4e995de71482783026d39910_223045_1024x0_resize_box_3.png 1024w" width=931 height=522 loading=lazy alt="FrameGraph SetUp"></a><figcaption>FrameGraph SetUp</figcaption></figure></p><p><figure style=flex-grow:178;flex-basis:429px><a href=/post/40/12.png data-size=929x519><img src=/post/40/12.png srcset="/post/40/12_hu38022051c21edc0d9627731a98c46dc6_287057_480x0_resize_box_3.png 480w, /post/40/12_hu38022051c21edc0d9627731a98c46dc6_287057_1024x0_resize_box_3.png 1024w" width=929 height=519 loading=lazy alt="FrameGraph RenderPass"></a><figcaption>FrameGraph RenderPass</figcaption></figure></p><p>资源这里就不多说了，可以自己看看原 Talk，主要是 RenderPass，FrameGraph 用一个结构体来描述 RenderPass 节点的输入输出资源，用两个 Lambda 表达式来描述 RenderPass 节点的 SetUp 和 Execute 流程，这里的 Execute 实际上就是真正的绘制过程了，FrameGraph 和 RHI 就是在这里结合的。</p><p>FrameGraph 是 RPI 的重要组成部分，可以说它是 Renderer 的骨架，而 RHI 则是 Renderer 的血肉，它俩配合可以为可编程渲染管线提供强大的支持。</p><h1 id=思考>思考</h1><h2 id=反射系统搭建>反射系统搭建</h2><p>我很喜欢拿反射系统说事，之前也写过 <a class=link href=https://flyandnotdown.github.io/post/33/ target=_blank rel=noopener>一篇对反射系统的剖析</a>，不过那是针对 UnrealEngine 的。反射系统在游戏引擎中最大的作用，无非就两个：</p><ul><li>自动序列化</li><li>脚本符号注册</li></ul><p>我们目前准备使用 <a class=link href=https://github.com/rttrorg/rttr target=_blank rel=noopener>rttr</a> 或者 <a class=link href=https://github.com/skypjack/meta target=_blank rel=noopener>meta</a>，rttr 应该不说我多说了，老牌反射框架了，meta 是 entt 内置的反射框架，作者 skypjack 觉得市面上没什么好的反射框架然后自己写的。其实从工程建设角度看我更认可 meta 一些，但是 meta 提供的接口实在是不好用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>hash</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string_view</span><span class=o>&gt;</span> <span class=n>hash</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>meta</span><span class=o>::</span><span class=n>reflect</span><span class=o>&lt;</span><span class=n>my_type</span><span class=o>&gt;</span><span class=p>(</span><span class=n>hash</span><span class=p>(</span><span class=s>&#34;reflected&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>data</span><span class=o>&lt;&amp;</span><span class=n>my_type</span><span class=o>::</span><span class=n>static_variable</span><span class=o>&gt;</span><span class=p>(</span><span class=n>hash</span><span class=p>(</span><span class=s>&#34;static&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>data</span><span class=o>&lt;&amp;</span><span class=n>my_type</span><span class=o>::</span><span class=n>data_member</span><span class=o>&gt;</span><span class=p>(</span><span class=n>hash</span><span class=p>(</span><span class=s>&#34;member&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>data</span><span class=o>&lt;&amp;</span><span class=n>global_variable</span><span class=o>&gt;</span><span class=p>(</span><span class=n>hash</span><span class=p>(</span><span class=s>&#34;global&#34;</span><span class=p>));</span>
</span></span></code></pre></div><p>他这里的写法非常巧妙，用地址（地址本身也是一个 uint32_t 或者 uint64_t）来作为模板参数，我第一开始愣是没看懂这写法，不过仔细读一读还好，相当于一口气完成了地址与类型的双重注册，不过我想诟病的地方在于作者为了追求极限性能，连 identity 参数都用了 hash + string_view，就离谱 &mldr;&mldr;</p><p>如果我们最终使用 meta 的话，还是要再封装一层。rttr 的话，接口是比较好用的，但我接受不了的是 rttr 的工程竟然用 cmake 去检查 README 和 LICENSE 符不符合它的要求 &mldr;&mldr;</p><p>具体使用哪个写到反射系统的时候再挑选吧，实在不行自己写一个也不是什么麻烦事，<strong>我是比较倾向于静态反射的</strong>，而 UE 的反射系统是动态反射，实现起来还稍微有些区别，性能上也要差一截，优点就是<strong>动态反射对脚本很友好</strong>，看完下一小节你就知道我说的是什么了。</p><h2 id=脚本如何与-ecs-融合呢>脚本如何与 ECS 融合呢？</h2><p>其实我早就说了，引擎本身按照 ECS 逻辑编写并不代表脚本也要套 ECS。如果是从头到尾都用 ECS 的话，那么用户必须要接受的是改变以前写 GameObject 的风格，投入编写 Component 和 System 的怀抱。</p><p>设想反射系统最后是用纯静态反射，ECS 也在 C++ 层开始构建，脚本完全 ECS 化，那么我们就避不开一个大问题 —— <strong>“用户自定义的 Component 要怎么被下面 C++ 所感知到？”</strong></p><p>假设用户在脚本里面定义了一个 Component 和一个 System：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>helloComp</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>a</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=o>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>helloSystem</span> <span class=o>=</span> <span class=p>(</span><span class=nx>registry</span><span class=p>,</span> <span class=nx>time</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// systen logic
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>这里用户自定义的 HelloComp 对应的 C++ 的 Archetype 很明显是：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>HelloComp</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Comp</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>但不巧的是脚本是弱类型的，C++ 根本就没办法感知到类型好嘛？那实际上填充数据的时候，entt 可是需要这样的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>entt</span><span class=o>::</span><span class=n>registry</span> <span class=n>registry</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=k>auto</span> <span class=n>entity</span> <span class=o>=</span> <span class=n>registry</span><span class=p>.</span><span class=n>create</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>registry</span><span class=p>.</span><span class=n>emplace</span><span class=o>&lt;</span><span class=n>HelloComp</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span></code></pre></div><p>这里的模板参数根本就没法填 &mldr;&mldr;</p><p>我和 <a class=link href=https://github.com/bluesky013 target=_blank rel=noopener>bluesky013</a> 讨论后，我们一起得到一个可行的方案，就是用户将 Component 和 System 分开为两个文件编写，System 部分不动，Component 部分修改成下面这样：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// hello.comp.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>const</span> <span class=nx>entry</span> <span class=o>=</span> <span class=p>(</span><span class=nx>componentManager</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>componentManager</span><span class=p>.</span><span class=nx>define</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Hello&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>attrs</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>a</span><span class=o>:</span> <span class=nx>DataType</span><span class=p>.</span><span class=nx>Int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>b</span><span class=o>:</span> <span class=nx>DataType</span><span class=p>.</span><span class=nx>Int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>c</span><span class=o>:</span> <span class=nx>DataType</span><span class=p>.</span><span class=nx>Int</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>然后我们需要<strong>经过一轮预编译</strong>，我们的预编译器会执行所有的 .comp.js 文件，然后找到 entry 方法进行调用，执行完所有类型的注册之后，预编译期会从 componentManager 中取出所有的 Component 类型信息，生成一系列头文件和代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// hello.generated.h
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Hello</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Comp</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// hello.generated.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>RegisterComp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 一些初始化的事情，会在库被加载时被自动执行
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这样就能让脚本系统里面定义的类型也被 C++ 感知到了，这个思路其实和 QT、UE 很想，只不过他们是对 C++ 进行元编译，我们是对脚本语言而已~</p><h2 id=脚本语言和引擎的选择>脚本语言和引擎的选择</h2><p>我是狂热的 JavaScript 爱好者，所以 Explosion 的脚本语言当然要使用 JavaScript 啦~</p><p>兜了一圈我看了很多小型嵌入式 JavaScript 引擎，不过说实话质量都一般般，挣扎了一波后我还是准备把这个大家伙给带进来：<a class=link href=https://v8.dev/ target=_blank rel=noopener>V8</a></p><p>经过这波调研我才发现，果真 V8 出来都没人敢做 JavaScript 引擎了，它的统治地位真没啥好说的 &mldr;&mldr;</p><p>简单看了一下集成指南 —— <a class=link href=https://v8.dev/docs/embed target=_blank rel=noopener>Getting started with embedding V8</a>，官方例子如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Copyright 2015 the V8 project authors. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=c1>// Use of this source code is governed by a BSD-style license that can be
</span></span></span><span class=line><span class=cl><span class=c1>// found in the LICENSE file.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;include/libplatform/libplatform.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;include/v8.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Initialize V8.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>v8</span><span class=o>::</span><span class=n>V8</span><span class=o>::</span><span class=n>InitializeICUDefaultLocation</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span><span class=o>::</span><span class=n>V8</span><span class=o>::</span><span class=n>InitializeExternalStartupData</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>v8</span><span class=o>::</span><span class=n>Platform</span><span class=o>&gt;</span> <span class=n>platform</span> <span class=o>=</span> <span class=n>v8</span><span class=o>::</span><span class=n>platform</span><span class=o>::</span><span class=n>NewDefaultPlatform</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span><span class=o>::</span><span class=n>V8</span><span class=o>::</span><span class=n>InitializePlatform</span><span class=p>(</span><span class=n>platform</span><span class=p>.</span><span class=n>get</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span><span class=o>::</span><span class=n>V8</span><span class=o>::</span><span class=n>Initialize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Create a new Isolate and make it the current one.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>v8</span><span class=o>::</span><span class=n>Isolate</span><span class=o>::</span><span class=n>CreateParams</span> <span class=n>create_params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>create_params</span><span class=p>.</span><span class=n>array_buffer_allocator</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=n>v8</span><span class=o>::</span><span class=n>ArrayBuffer</span><span class=o>::</span><span class=n>Allocator</span><span class=o>::</span><span class=n>NewDefaultAllocator</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span><span class=o>::</span><span class=n>Isolate</span><span class=o>*</span> <span class=n>isolate</span> <span class=o>=</span> <span class=n>v8</span><span class=o>::</span><span class=n>Isolate</span><span class=o>::</span><span class=n>New</span><span class=p>(</span><span class=n>create_params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v8</span><span class=o>::</span><span class=n>Isolate</span><span class=o>::</span><span class=n>Scope</span> <span class=n>isolate_scope</span><span class=p>(</span><span class=n>isolate</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create a stack-allocated handle scope.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v8</span><span class=o>::</span><span class=n>HandleScope</span> <span class=n>handle_scope</span><span class=p>(</span><span class=n>isolate</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create a new context.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v8</span><span class=o>::</span><span class=n>Local</span><span class=o>&lt;</span><span class=n>v8</span><span class=o>::</span><span class=n>Context</span><span class=o>&gt;</span> <span class=n>context</span> <span class=o>=</span> <span class=n>v8</span><span class=o>::</span><span class=n>Context</span><span class=o>::</span><span class=n>New</span><span class=p>(</span><span class=n>isolate</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Enter the context for compiling and running the hello world script.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v8</span><span class=o>::</span><span class=n>Context</span><span class=o>::</span><span class=n>Scope</span> <span class=n>context_scope</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create a string containing the JavaScript source code.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v8</span><span class=o>::</span><span class=n>Local</span><span class=o>&lt;</span><span class=n>v8</span><span class=o>::</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>source</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>v8</span><span class=o>::</span><span class=n>String</span><span class=o>::</span><span class=n>NewFromUtf8</span><span class=p>(</span><span class=n>isolate</span><span class=p>,</span> <span class=s>&#34;&#39;Hello&#39; + &#39;, World!&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>v8</span><span class=o>::</span><span class=n>NewStringType</span><span class=o>::</span><span class=n>kNormal</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>ToLocalChecked</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Compile the source code.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v8</span><span class=o>::</span><span class=n>Local</span><span class=o>&lt;</span><span class=n>v8</span><span class=o>::</span><span class=n>Script</span><span class=o>&gt;</span> <span class=n>script</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>v8</span><span class=o>::</span><span class=n>Script</span><span class=o>::</span><span class=n>Compile</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>source</span><span class=p>).</span><span class=n>ToLocalChecked</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Run the script to get the result.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v8</span><span class=o>::</span><span class=n>Local</span><span class=o>&lt;</span><span class=n>v8</span><span class=o>::</span><span class=n>Value</span><span class=o>&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>script</span><span class=o>-&gt;</span><span class=n>Run</span><span class=p>(</span><span class=n>context</span><span class=p>).</span><span class=n>ToLocalChecked</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert the result to an UTF8 string and print it.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>v8</span><span class=o>::</span><span class=n>String</span><span class=o>::</span><span class=n>Utf8Value</span> <span class=n>utf8</span><span class=p>(</span><span class=n>isolate</span><span class=p>,</span> <span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=o>*</span><span class=n>utf8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Dispose the isolate and tear down V8.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>isolate</span><span class=o>-&gt;</span><span class=n>Dispose</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span><span class=o>::</span><span class=n>V8</span><span class=o>::</span><span class=n>Dispose</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span><span class=o>::</span><span class=n>V8</span><span class=o>::</span><span class=n>ShutdownPlatform</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>delete</span> <span class=n>create_params</span><span class=p>.</span><span class=n>array_buffer_allocator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>说实话其实和 Lua 差不多，应该难度不高，但还是要先试试，不知道这么大体量的怪物会不会有什么天坑 &mldr;&mldr;</p><p>最后，还是跟自己和 Explosion 说一声加油~</p><h1 id=参考资料>参考资料</h1><ul><li><a class=link href=https://www.gdcvault.com/play/1024612/FrameGraph-Extensible-Rendering-Architecture-in target=_blank rel=noopener>GDC Vault - FrameGraph</a></li><li><a class=link href=https://github.com/rttrorg/rttr target=_blank rel=noopener>rttr</a></li><li><a class=link href=https://github.com/skypjack/entt target=_blank rel=noopener>EnTT</a></li><li><a class=link href=https://github.com/skypjack/meta target=_blank rel=noopener>meta</a></li><li><a class=link href=https://v8.dev/ target=_blank rel=noopener>V8 JavaScript Engine</a></li><li><a class=link href=https://chromium.googlesource.com/v8/v8/+/branch-heads/6.8/samples/hello-world.cc target=_blank rel=noopener>Embedded V8 Sample</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/explosion/>Explosion</a>
<a href=/tags/game/>Game</a>
<a href=/tags/graphics/>Graphics</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/post/44/><div class=article-details><h2 class=article-title>Explosion 开发笔记 (四)</h2></div></a></article><article><a href=/post/37/><div class=article-details><h2 class=article-title>Explosion 开发笔记 (二)</h2></div></a></article><article><a href=/post/35/><div class=article-details><h2 class=article-title>Explosion 开发笔记 (一)</h2></div></a></article><article><a href=/post/34/><div class=article-details><h2 class=article-title>UnrealEngine4 源码剖析 (二) 垃圾回收</h2></div></a></article><article><a href=/post/33/><div class=article-details><h2 class=article-title>UnrealEngine4 源码剖析 (一) UObject 概览及反射系统</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=FlyAndNotDown/KindemBlog issue-term=title crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;setUtterancesTheme(document.body.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2024 Kindem的博客</section><section class=powerby>©2017-2021 Copyright Kindem<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>